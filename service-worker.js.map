{"version":3,"file":"service-worker.js","sources":["../src/service-worker.js"],"sourcesContent":["const CACHE = 'stock-stats-cache-v1';\n\nfunction precache() {\n  return caches.open(CACHE).then(function(cache) {\n    return cache.addAll([\n      './bundle.css',\n      './bundle.js',\n      './global.css',\n      './favicon.png'\n    ]).catch(err => console.error('caching failed', err));\n  });\n}\n\nfunction cacheResponse(event, request, response) {\n\n  return caches.open(CACHE).then(cache => {\n\n    if (!event.clientId) {\n      cache.put(request, response);\n\n      return;\n    }\n\n    /* global clients */\n    return clients.get(event.clientId).then(client => {\n\n      return cache.match(request).then(matchingResponse => {\n\n        if (matchingResponse) {\n\n          const oldEtag = matchingResponse.headers.get('ETag');\n          const newEtag = response.headers.get('ETag');\n\n          if (oldEtag !== newEtag) {\n            client.postMessage({\n              message: 'resource.changed',\n              url: request.url\n            });\n          }\n        }\n\n        cache.put(request, response);\n      });\n    });\n  });\n}\n\nfunction fromNetwork(event, request) {\n\n  return fetch(request).then(response => {\n\n    if (response && response.status === 200) {\n      const cachedResponse = response.clone();\n\n      event.waitUntil(\n        cacheResponse(event, request, cachedResponse)\n      );\n    }\n\n    return response;\n  });\n}\n\nfunction fromCache(event, request) {\n  return caches.open(CACHE).then(cache => {\n    return cache.match(request).then(matching => {\n      return matching || Promise.reject('not-in-cache');\n    });\n  });\n}\n\nself.addEventListener('install', event => {\n  event.waitUntil(\n    precache(event)\n  );\n\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', function(event) {\n  event.waitUntil(self.clients.claim());\n});\n\n// actual fetching logic ////////////\n\nself.addEventListener('fetch', function(event) {\n\n  let { request } = event;\n\n  const { url } = request;\n\n  const {\n    scope\n  } = self.registration;\n\n  if (!url.startsWith(scope)) {\n    return;\n  }\n\n  if (url.startsWith(self.registration.scope + '?')) {\n    request = new Request(self.registration.scope);\n  }\n\n  const remoteFetch = fromNetwork(event, request);\n\n  event.respondWith(\n    fromCache(event, request)\n      .catch(() => remoteFetch)\n  );\n\n  event.waitUntil(remoteFetch);\n\n});"],"names":[],"mappings":"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"}